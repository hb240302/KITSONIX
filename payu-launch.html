<!DOCTYPE html>
<html>
<body>
<script>
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  if (!token) {
    document.body.innerHTML = "Invalid payment session";
    throw new Error("Missing token");
  }

  fetch(
    "https://www.kitsonix.com/_functions/getPayUData?token=" + token
  )
    .then(res => res.json())
    .then(data => {
      const form = document.createElement("form");
      form.method = "POST";
      form.action = "https://secure.payu.in/_payment";

      Object.keys(data).forEach(k => {
        const i = document.createElement("input");
        i.type = "hidden";
        i.name = k;
        i.value = data[k];
        form.appendChild(i);
      });

      document.body.appendChild(form);
      form.submit();
    })
    .catch(() => {
      document.body.innerHTML = "Payment session expired";
    });
</script>
</body>
</html>
